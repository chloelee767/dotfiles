#!/usr/bin/env bash

set -eou pipefail

show_help() {
    cat << 'EOF'
Usage: k-add-host [QUERY]
  Add local hostname to /etc/hosts in remote pod (needed for mirrord).

Examples:
  k-add-host myapp    # Add hostname to myapp pod
EOF
}

if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
    show_help
    exit 0
fi

host="$(hostname)"

echo "Adding host: $host"

kexec --bash-cmd "echo 127.0.0.1 $host >> /etc/hosts; cat /etc/hosts"

# kubectl exec bump-7bb5c66cd4-kzwsd --container bump -- /bin/bash -c 'echo "127.0.0.1  CMBP-SG-MAR22-0323.local" >> /etc/hosts'
