#!/usr/bin/env sh

set -eou pipefail

show_help() {
    cat << 'EOF'
Usage: jq-preview FILE
  Interactive jq query builder with fzf preview.

Examples:
  jq-preview data.json    # Interactively build jq query
EOF
}

if [ "${1:-}" = "-h" ] || [ "${1:-}" = "--help" ]; then
    show_help
    exit 0
fi

if [ $# -ne 1 ]; then
    show_help
    exit 1
fi

printf '' | fzf --print-query \
  --preview "jq -C {q} '$1' 2>&1" \
  --preview-window=up:80% \
  --query "."
