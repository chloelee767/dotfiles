#!/usr/bin/env bash

show_help() {
    cat << 'EOF'
Usage: check-query-templates-in-sync DIR
  Diff *_prod.sql and *_stage.sql files in DIR to check sync.

Examples:
  check-query-templates-in-sync ~/Code/query-store/cats/invoice
EOF
}

while [[ $# -gt 0 ]]
do
    case "$1" in
        -h|--help)
            show_help
            exit 0
            ;;
        *)
            break
            ;;
    esac
done

if [ $# -ne 1 ]; then
    show_help
    exit 1
fi

cd "$1"
for f in *_prod.sql; do
    s="${f/_prod.sql/_stage.sql}"
    if [ -f "$s" ]; then
        echo "$f"
        diff "$f" "$s"
        printf "\n\n"
    fi
done
